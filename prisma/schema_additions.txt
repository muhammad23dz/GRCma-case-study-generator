// Framework Requirements - Store actual compliance requirements
model FrameworkRequirement {
  id             String   @id @default(cuid())
  frameworkId    String
  requirementId  String   // e.g., "A.5.1", "CC6.1", "PR.AC-1"
  title          String
  description    String
  category       String   // Control domain/category
  priority       String   @default("medium") // critical, high, medium, low
  createdAt      DateTime @default(now())
  
  framework      Framework @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  mappings       ControlMapping[] @relation("RequirementMappings")
  
  @@unique([frameworkId, requirementId])
  @@index([frameworkId])
  @@index([category])
}

// Enhanced FrameworkMapping to include requirement details
model ControlMapping {
  id                 String   @id @default(cuid())
  controlId          String
  frameworkId        String
  requirementId      String?  // Link to FrameworkRequirement
  frameworkControlId String   // e.g., "AC-2" for NIST, "A.9.2.1" for ISO
  confidence         Float    // 0-1
  mappingSource      String   // llm, manual, authoritative
  implementationNotes String? // How this control satisfies the requirement
  createdAt          DateTime @default(now())
  createdBy          String?  // User who created the mapping
  
  control            Control  @relation(fields: [controlId], references: [id], onDelete: Cascade)
  framework          Framework @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  requirement        FrameworkRequirement? @relation("RequirementMappings", fields: [requirementId], references: [id])
  
  @@unique([controlId, frameworkId, frameworkControlId])
  @@index([controlId])
  @@index([frameworkId])
  @@index([requirementId])
}
